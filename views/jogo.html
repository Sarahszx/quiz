<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quiz de L√≥gica</title>
  <link rel="stylesheet" href="../styles/jogo.css" />
  <link rel="icon" href="../imagem/favicon.png" />
</head>
<body>

  <a href="../index.html" class="voltar-menu">&#8592;</a>

  <div id="login-container">
    <h2>Informe seu nome</h2>
    <input type="text" id="nome" placeholder="Nome de usu√°rio">
    <button id="btn-iniciar">Iniciar Quiz</button>
  </div>

  <div class="cronometro" style="display:none;">
    ‚è±Ô∏è <span id="tempo">00:30</span>
  </div>

  <div class="quiz-container" style="display:none; position: relative;">
    <div class="quiz-header">
      <h1>Pergunta 1 de 10</h1>
    </div>
    <div class="quiz-body">
      <h2 id="pergunta"></h2>
      <div class="op√ß√µes" id="opcoes"></div>
      <button class="bot√£o-avan√ßar" disabled>Pr√≥xima</button>
    </div>
  </div>

  <div class="pontuacao-container" style="display:none;">
    <div class="pontuacao-header">
      <h2>Pontua√ß√£o</h2>
    </div>
    <div class="pontuacao-body">
      <div class="linha">
        <span class="categoria">F√°ceis</span>
        <span class="resultado">Obteve <strong id="pontos-faceis">0P</strong></span>
      </div>
      <hr>
      <div class="linha">
        <span class="categoria">M√©dias</span>
        <span class="resultado">Obteve <strong id="pontos-medias">0P</strong></span>
      </div>
      <hr>
      <div class="linha">
        <span class="categoria">Dif√≠ceis</span>
        <span class="resultado">Obteve <strong id="pontos-dificeis">0P</strong></span>
      </div>
    </div>
    <div class="pontuacao-footer">
      <button id="btn-ranking">Ir para Ranking</button>
    </div>
  </div>

  <div class="ranking-container" style="display:none;">
    <div class="ranking-header">üëë Top 10</div>
    <div class="ranking-body" id="ranking-body">
      <div class="ranking-coluna" id="coluna1"></div>
      <div class="ranking-coluna" id="coluna2"></div>
    </div>
  </div>

<script>
const loginContainer = document.getElementById("login-container");
const quizContainer = document.querySelector(".quiz-container");
const cronometroDiv = document.querySelector(".cronometro");
const pontuacaoContainer = document.querySelector(".pontuacao-container");
const rankingContainer = document.querySelector(".ranking-container");

const pontosFacil = document.getElementById("pontos-faceis");
const pontosMedia = document.getElementById("pontos-medias");
const pontosDificil = document.getElementById("pontos-dificeis");

let nomeUsuario, idUsuario;

const pontuacaoQuizDiv = document.createElement("div");
pontuacaoQuizDiv.id = "pontuacao-quiz";
quizContainer.appendChild(pontuacaoQuizDiv);

function atualizarPontuacaoVisual() {
  pontuacaoQuizDiv.innerHTML = 
    "F√°ceis: " + pontosCategorias.facil + "P<br>" +
    "M√©dias: " + pontosCategorias.media + "P<br>" +
    "Dif√≠ceis: " + pontosCategorias.dificil + "P";
}

function mostrarQuiz() {
  loginContainer.style.display = "none";
  quizContainer.style.display = "block";
  cronometroDiv.style.display = "block";
  carregarPerguntaAleatoria();
  atualizarPontuacaoVisual();
}

window.onload = function() {
  const nome = localStorage.getItem("nomeUsuario");
  const id = localStorage.getItem("idUsuario");
  if (nome && id) {
    nomeUsuario = nome;
    idUsuario = parseInt(id);
    mostrarQuiz();
  }
};

document.getElementById("btn-iniciar").onclick = function() {
  let nome = document.getElementById("nome").value.trim().toUpperCase();
  if (nome === "") return alert("Por favor, informe um nome de usu√°rio.");

  let ranking = JSON.parse(localStorage.getItem("ranking")) || [];
  for (let i = 0; i < ranking.length; i++) {
    if (ranking[i].nome === nome) return alert("Nome de usu√°rio j√° existe! Escolha outro.");
  }

  let id = Date.now();
  localStorage.setItem("nomeUsuario", nome);
  localStorage.setItem("idUsuario", id);

  nomeUsuario = nome;
  idUsuario = id;

  mostrarQuiz();
};

const perguntas = [
  {
    pergunta: "Qual √© a fun√ß√£o da tag <title> em um documento HTML?",
    opcoes: ["Exibir o t√≠tulo no corpo da p√°gina", "Definir o t√≠tulo que aparece na aba do navegador", "Adicionar uma legenda a uma imagem", "Criar um cabe√ßalho vis√≠vel na pagina"],
    resposta: "b",
    categoria: "facil"
  },
  {
    pergunta: "Como se aplica uma cor de fundo azul a uma p√°gina com CSS?",
    opcoes: ["background-color: red;", "color: blue;", "bgcolor: blue;", "background-color: blue;"],
    resposta: "d",
    categoria: "facil"
  },
  {
    pergunta: "Qual √© o operador usado para atribui√ß√£o de valor em JavaScript?",
    opcoes: ["=", "==", "===", "=>"],
    resposta: "a",
    categoria: "facil"
  },
  {
    pergunta: "Qual propriedade CSS √© usada para criar espa√ßamento entre elementos (por fora)?",
    opcoes: ["padding", "spacing", "margin", "border"],
    resposta: "c",
    categoria: "media"
  },
  {
    pergunta: "O que a fun√ß√£o Math.floor(5.9) retorna?",
    opcoes: ["5.9", "6", "5", "Erro"],
    resposta: "c",
    categoria: "media"
  },
  {
    pergunta: "Qual dessas estruturas √© usada para repetir um bloco de c√≥digo enquanto uma condi√ß√£o for verdadeira?",
    opcoes: ["for", "if", "switch", "while"],
    resposta: "d",
    categoria: "media"
  },
  {
    pergunta: "O que diferencia TypeScript do JavaScript?",
    opcoes: ["TypeScript permite tipagem est√°tica", "TypeScript n√£o funciona em navegadores", "TypeScript √© mais r√°pido", "TypeScript √© usado apenas para back-end"],
    resposta: "a",
    categoria: "media"
  },
  {
    pergunta: "Como centralizar um texto horizontalmente dentro de uma div com CSS?",
    opcoes: ["text-align: left;", "justify-content: center;", "text-align: center;", "align-items: center;"],
    resposta: "c",
    categoria: "media"
  },
  {
    pergunta: "Qual a principal vantagem da tipagem est√°tica em TypeScript?",
    opcoes: ["Facilita a edi√ß√£o de imagens", "Permite que o c√≥digo rode mais devagar", "Evita muitos erros em tempo de execu√ß√£o ao detectar problemas antes de rodar o programa", "Substitui a necessidade de JavaScript"],
    resposta: "c",
    categoria: "dificil"
  },
  {
    pergunta: "Em JavaScript, o que √© closure?",
    opcoes: ["√â uma fun√ß√£o que lembra do escopo onde foi criada, mesmo ap√≥s esse escopo ter sido finalizado", "√â um erro que ocorre quando uma fun√ß√£o n√£o retorna nada", "√â uma t√©cnica usada para fechar conex√µes com o banco de dados", "√â o mesmo que uma fun√ß√£o recursiva"],
    resposta: "a",
    categoria: "dificil"
  }
];

const letras = ['a', 'b', 'c', 'd'];
let perguntaAtual, tempoRestante = 30, cronometro, respondeu = false, indicePergunta = 0;
const pontosCategorias = { facil: 0, media: 0, dificil: 0 };

const perguntasEmbaralhadas = [...perguntas].sort(function() { return Math.random() - 0.5; });
const perguntaH2 = document.getElementById("pergunta");
const opcoesDiv = document.getElementById("opcoes");
const botaoAvancar = document.querySelector(".bot√£o-avan√ßar");
const tempoSpan = document.getElementById("tempo");

function atualizarTempo() { tempoSpan.textContent = "00:" + (tempoRestante < 10 ? "0" : "") + tempoRestante; }

function iniciarCronometro() {
  clearInterval(cronometro); tempoRestante = 30; atualizarTempo();
  cronometro = setInterval(function() {
    tempoRestante--; atualizarTempo();
    if (tempoRestante <= 0) { clearInterval(cronometro); if (!respondeu) encerrarTempo(); }
  }, 1000);
}

function encerrarTempo() {
  document.querySelectorAll(".op√ß√£o").forEach(function(btn) { btn.disabled = true; });
  mostrarCorreta();
  botaoAvancar.disabled = false;
}

function mostrarCorreta() {
  document.querySelectorAll(".op√ß√£o").forEach(function(btn) {
    if (btn.dataset.letra === perguntaAtual.resposta) btn.classList.add("correta");
  });
}

function carregarPerguntaAleatoria() {
  if (indicePergunta >= 10) return;
  perguntaAtual = perguntasEmbaralhadas[indicePergunta];
  perguntaH2.innerText = perguntaAtual.pergunta;
  document.querySelector(".quiz-header h1").innerText = "Pergunta " + (indicePergunta + 1) + " de 10";
  botaoAvancar.disabled = true; respondeu = false; opcoesDiv.innerHTML = "";
  for (let i = 0; i < letras.length; i++) {
    const btn = document.createElement("button");
    btn.classList.add("op√ß√£o"); btn.dataset.letra = letras[i];
    btn.innerHTML = letras[i] + ") " + perguntaAtual.opcoes[i].toLowerCase();
    btn.onclick = function() {
      if (respondeu) return;
      if (btn.dataset.letra === perguntaAtual.resposta) {
        btn.classList.add("correta");
        pontosCategorias[perguntaAtual.categoria] += tempoRestante;
        atualizarPontuacaoVisual();
      } else { 
        btn.classList.add("errada"); 
        mostrarCorreta(); 
      }
      respondeu = true; 
      clearInterval(cronometro); 
      encerrarTempo();
    };
    opcoesDiv.appendChild(btn);
  }
  iniciarCronometro();
}

botaoAvancar.onclick = function() {
  indicePergunta++;
  if (indicePergunta === 10) {
    pontuacaoContainer.style.display = "block";
    pontosFacil.innerText = pontosCategorias.facil + "P";
    pontosMedia.innerText = pontosCategorias.media + "P";
    pontosDificil.innerText = pontosCategorias.dificil + "P";
    quizContainer.style.display = "none";
    cronometroDiv.style.display = "none";

    let ranking = JSON.parse(localStorage.getItem("ranking")) || [];
    let totalPontos = pontosCategorias.facil + pontosCategorias.media + pontosCategorias.dificil;

    ranking = ranking.filter(function(j) { return j.nome !== nomeUsuario; });
    ranking.push({ id: idUsuario, nome: nomeUsuario, pontos: totalPontos });

    localStorage.setItem("ranking", JSON.stringify(ranking));

  } else { carregarPerguntaAleatoria(); }
};

var btnRanking = document.getElementById("btn-ranking");
btnRanking.onclick = function() {
  pontuacaoContainer.style.display = "none";
  rankingContainer.style.display = "block";

  let ranking = JSON.parse(localStorage.getItem("ranking")) || [];
  ranking.sort(function(a,b){ return b.pontos - a.pontos; });
  let top10 = ranking.slice(0,10);

  let coluna1 = document.getElementById("coluna1");
  let coluna2 = document.getElementById("coluna2");
  coluna1.innerHTML = ""; coluna2.innerHTML = "";

  top10.forEach(function(jogador, index) {
    let div = document.createElement("div");
    div.classList.add("ranking-item");
    let medalha = "";
    if (index === 0) medalha = "ü•á";
    else if (index === 1) medalha = "ü•à";
    else if (index === 2) medalha = "ü•â";
    else medalha = "üèÖ";
    div.textContent = medalha + (index+1) + ". " + jogador.nome + " - " + jogador.pontos + "P";
    if (index < 5) coluna1.appendChild(div);
    else coluna2.appendChild(div);
  });
};
</script>

</body>
</html>
